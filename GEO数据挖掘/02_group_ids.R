# Group(å®éªŒåˆ†ç»„)å’Œids(æ¢é’ˆæ³¨é‡Š)
rm(list = ls())  
load(file = "step1output.Rdata")
# 1.Group----
library(stringr)
# æ ‡å‡†æµç¨‹ä»£ç æ˜¯äºŒåˆ†ç»„ï¼Œå¤šåˆ†ç»„æ•°æ®çš„åˆ†æåé¢å¦è®²
# ç”ŸæˆGroupå‘é‡çš„ä¸‰ç§å¸¸è§„æ–¹æ³•ï¼Œä¸‰é€‰ä¸€ï¼Œé€‰è°å°±æŠŠç¬¬å‡ ä¸ªé€»è¾‘å€¼å†™æˆTï¼Œå¦å¤–ä¸¤ä¸ªä¸ºFã€‚å¦‚æœä¸‰ç§åŠæ³•éƒ½ä¸é€‚ç”¨ï¼Œå¯ä»¥ç»§ç»­å¾€åå†™else if
if(F){
  # ç¬¬ä¸€ç§æ–¹æ³•ï¼Œæœ‰ç°æˆçš„å¯ä»¥ç”¨æ¥åˆ†ç»„çš„åˆ—
  
}else if(F){
  # ç¬¬äºŒç§æ–¹æ³•ï¼Œçœ¼ç›æ•°ï¼Œè‡ªå·±ç”Ÿæˆ
  Group = rep(c("Disease","Normal"),each = 10)
  # repå‡½æ•°çš„å…¶ä»–ç”¨æ³•ï¼Ÿç›¸é—´ã€ä¸¤ç»„çš„æ•°é‡ä¸åŒï¼Ÿ
}else if(T){
  # ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œä½¿ç”¨å­—ç¬¦ä¸²å¤„ç†çš„å‡½æ•°è·å–åˆ†ç»„
  k = str_detect(pd$title,"Normal");table(k)
  Group = ifelse(k,"Normal","Disease")
}

# éœ€è¦æŠŠGroupè½¬æ¢æˆå› å­ï¼Œå¹¶è®¾ç½®å‚è€ƒæ°´å¹³ï¼ŒæŒ‡å®šlevelsï¼Œå¯¹ç…§ç»„åœ¨å‰ï¼Œå¤„ç†ç»„åœ¨å
Group = factor(Group,levels = c("Normal","Disease"))
Group

#2.æ¢é’ˆæ³¨é‡Šçš„è·å–-----------------
#æ·å¾„
library(tinyarray)
find_anno(gpl_number) #è¾…åŠ©å†™å‡ºæ‰¾æ³¨é‡Šçš„ä»£ç 
library(hgu133plus2.db);ids <- toTable(hgu133plus2SYMBOL) 
#è¿™æ˜¯ä»28è¡Œè¿è¡Œç»“æœé‡Œå¤åˆ¶ä¸‹æ¥çš„ä»£ç ğŸ‘†
#å¦‚æœèƒ½æ‰“å‡ºä»£ç å°±ä¸éœ€è¦å†ç®¡å…¶ä»–æ–¹æ³•ã€‚
#å¦‚æœä½¿ç”¨å¤åˆ¶ä¸‹æ¥çš„AnnoProbe::idmap('xxx')ä»£ç å‘ç°æŠ¥é”™äº†ï¼Œè¯·æ³¨æ„å°è¯•ä¸åŒçš„typeå‚æ•°
#å¦‚æœæ˜¾ç¤ºno annotation avliable in Bioconductor and AnnoProbeåˆ™è¦å»GEOç½‘é¡µä¸Šçœ‹GPLè¡¨æ ¼é‡Œæ‰¾å•¦ã€‚

#å››ç§æ–¹æ³•ï¼Œæ–¹æ³•1é‡Œæ‰¾ä¸åˆ°å°±ä»æ–¹æ³•2æ‰¾ï¼Œä»¥æ­¤ç±»æ¨ã€‚
#æ·å¾„é‡Œé¢åŒ…å«äº†å…¨éƒ¨çš„RåŒ…ã€ä¸€éƒ¨åˆ†è¡¨æ ¼ã€ä¸€éƒ¨åˆ†è‡ªä¸»æ³¨é‡Š
#æ–¹æ³•1 BioconductorRåŒ…(æœ€å¸¸ç”¨ï¼Œå·²å…¨éƒ¨æ”¶å…¥find_annoé‡Œé¢ï¼Œä¸ç”¨çœ‹å•¦)
if(F){
  gpl_number #çœ‹çœ‹ç¼–å·æ˜¯å¤šå°‘
  #http://www.bio-info-trainee.com/1399.html #åœ¨è¿™é‡Œæœç´¢ï¼Œæ‰¾åˆ°å¯¹åº”çš„RåŒ…
  library(hgu133plus2.db)
  ls("package:hgu133plus2.db") #åˆ—å‡ºRåŒ…é‡Œéƒ½æœ‰å•¥
  ids <- toTable(hgu133plus2SYMBOL) #æŠŠRåŒ…é‡Œçš„æ³¨é‡Šè¡¨æ ¼å˜æˆæ•°æ®æ¡†
}
# æ–¹æ³•2 è¯»å–GPLç½‘é¡µçš„è¡¨æ ¼æ–‡ä»¶ï¼ŒæŒ‰åˆ—å–å­é›†
##https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GPL570
# æ–¹æ³•3 å®˜ç½‘ä¸‹è½½æ³¨é‡Šæ–‡ä»¶å¹¶è¯»å–
# æ–¹æ³•4 è‡ªä¸»æ³¨é‡Šï¼Œäº†è§£ä¸€ä¸‹
#https://mp.weixin.qq.com/s/mrtjpN8yDKUdCSvSUuUwcA
save(exp,Group,ids,file = "step2output.Rdata")
